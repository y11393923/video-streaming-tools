<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>video-streaming-tools</title>
    <style type="text/css">

    </style>
</head>
<body>
    <h2>视频源转流</h2>
    <div>
        <input type="button" class="bypassFlow" value="转流"/>
    </div>
    <div class="message">
        <div class="success">
            <dl>
                <dt style="font-weight: bold">转流成功：</dt>
            </dl>
        </div>
        <div class="failed">
            <dl>
                <dt style="font-weight: bold">转流失败：</dt>
            </dl>
        </div>
    </div>

    <hr/>
    <h2>视频上传</h2>
    <p>单视频上传支持格式：mp4、avi、mov、wmv、flv、asx、asf、mpg、3gp</p>
    <p>支持zip压缩包格式上传</p>
    <div>
        <form method="POST" enctype="multipart/form-data" action="/video/upload">
            <p>
                文件：<input type="file" name="file"/>
                <input type="submit" value="上传"/>
            </p>
            <p>
                <input type="button" class="clearAllVideos" value="清除所有上传视频"/>
            </p>
        </form>
    </div>

    <hr/>

    <script src="https://static-cdn.cocosurprise.com/js/jQuery/1.10.2/jquery.min.js"></script>
    <script>
        $(function () {
            $(".message").hide();
            $(".bypassFlow").click(function () {
                $(".message dl dd").remove();
                $(".failed dl dd").remove();
                $.ajax({
                    url: "/rtsp-server/diversion",
                    type: "GET",
                    dataType: "json",
                    data: {"userName": $("#username").val(), "password": $("#password").val()},
                    success: function (data) {
                        var data = data.data;
                        if (data.errorCode === "0"){
                            let dd = "";
                            $.each(data.success, function (i, obj) {
                                dd += "<dd>"+obj.rtspAddress+"</dd>";
                            })
                            $(".success dl").append(dd);
                            dd = "";
                            $.each(data.success, function (i, obj) {
                                dd += "<dd>"+obj.videoName+"&nbsp&nbsp&nbsp&nbsp原因:"+obj.errorMsg;
                                if (obj.detail !== ""){
                                    dd += "&nbsp&nbsp&nbsp&nbsp详情:" + obj.detail;
                                }
                                dd+= "</dd>";
                            })
                            $(".failed dl").append(dd);
                            $(".message").show();
                        } else{
                            alert("转流失败:" + data.errorMsg);
                        }
                    }
                })
            })
            $(".clearAllVideos").click(function () {
                $.ajax({
                    url: "/video/clear",
                    type: "DELETE",
                    dataType: "json",
                    success: function (data) {
                        if(data.errorCode === "0"){
                            alert("清理成功");
                        }else{
                            alert("清理失败:" + data.errorMsg)
                        }
                    }
                })
            })
        })
    </script>
</body>
</html>